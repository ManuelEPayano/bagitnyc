<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!--Edit the title of the page-->
    <title>#BagitNYC Map</title>
    <meta name="description" content="">
    <meta name="author" content="">
<!--
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
-->
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.ie.css" />
    <![endif]-->
    <!--Switch between the different themes changing the stylesheet below - light-theme.css |dark-theme.css -->
    <script src="https://maps.googleapis.com/maps/api/js?sensor=false&v=3.8"></script>
    <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>
<!--    <link rel="stylesheet" href="css/light-theme.css">-->
    <link rel="stylesheet" href="css/makeitresponsive.css">
    <link rel="stylesheet" href="css/light-theme.css">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Amatic+SC">
      <script type="text/javascript" src="instafeed.js/instafeed.min.js"></script>
  </head>
  <body>
      
<div id="container" class="container">
<div class="map" id="map">
        <script>
      function initialize() {
        cartodb.createVis('map', 'http://jossphilippe.cartodb.com/api/v2/viz/4dedce04-91da-11e3-ada5-0e49973114de/viz.json', {
            shareable: true,
            title: false,
            description: false,
            search: true,
            tiles_loader: true,
            center_lat: 40.711346,
            center_lon: -73.947826,
            zoom: 12
        })
        
       .done(function(vis, layers) {
        
        layers[1].getSubLayer(1).set({
           interactivity: 'url',
           infowindow: false,
        })
          layers[1].getSubLayer(0).set({
           interactivity: 'image',
           infowindow: false,
        })

        layers[1].on('featureOver', function(e, latlng, pos, data, layerNumber) {
      $('#portrait').attr('src', data.image);
    });
                
       layers[1].on('featureClick', function(e, latlng, pos, data, layerNumber) {
      $('#iframe').attr('src', data.url + "embed/");
           });

       });      
        
      }
            
            //display count of total instagrams taken so far
            $.getJSON("http://jossphilippe.cartodb.com/api/v2/sql?q=SELECT%20count(*)%20FROM%20instagram_media", function (data) {
                // Get the 'items' from the first group.
               
                var items = data.rows[0];
               
                // Find the last index and the last item.
                var count = items.count;
              //  alert(count);
                $("#count").prepend(count);
                console.log("Text: " + items.count);
            });
            
            
      window.onload = initialize;
    </script>
     </div>
<div class="councillegend">
    <img id="portrait" src="" height="45" width="45">
        <a>legend test</a>
</div>
    </div>
<div class="sidepanel">
    <div class="wrapper">
        <div class="context subheader">
          <h1>#BagitNYC</h1>
        </div>
        <p><a id="count"></a>Instagrams of plastic bag litter across NYC Council Districts</p>
          


<!--
<iframe id="iframe" src="" width="436" height="600" frameborder="0" scrolling="no" allowtransparency="true"></iframe>
-->
                    <iframe id="iframe" src="http://council.nyc.gov/d11/html/members/home.shtml" width="436" height="600" frameborder="0" scrolling="no" allowtransparency="true" style="-webkit-transform:scale(0.9);-moz-transform-scale(0.5);"></iframe>

                </div>
            </div>




  </body>
</html>
